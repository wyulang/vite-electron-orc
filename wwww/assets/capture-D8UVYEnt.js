import{d as g,k as c,r as w,c as b,a as m,n as f,o as x}from"./index-Dg9TTGAa.js";const _=g({__name:"capture",setup(k){const l=c(null),d=c(null),h=c(null),e=w({left:0,top:0,width:0,height:0,by:0,bx:0,isSha:!0}),r=c(null),p=c([]);window.storeApi.ipcRenderer("getSources").then(n=>{p.value=n,r.value=n[0],u()});function v(n){e.bx=n.clientX,e.by=n.clientY,document.onmousemove=o=>{let a=o.clientX,t=o.clientY;e.bx&&(l.value.style.left=e.bx+"px",l.value.style.top=e.by+"px",l.value.style.width=a-e.bx+"px",l.value.style.height=t-e.by+"px",e.width=a-e.bx,e.height=t-e.by)},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,l.value.style.display="none",u()}}function u(){const n=document.createElement("style");n.textContent=" html, body {cursor: none;overflow: hidden;}",document.head.appendChild(n);const o=window.devicePixelRatio||1;navigator.mediaDevices.getUserMedia({audio:!1,cursor:"never",video:{cursor:"never",mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r.value.id,minWidth:window.screen.width,maxWidth:window.screen.width*o,minHeight:window.screen.height,maxHeight:window.screen.height*o}}}).then(a=>{const t=document.createElement("video");t.className="abs ab0 al0",t.srcObject=a,e.isSha=!1,t.playsInline=!0,t.play(),t.onloadedmetadata=()=>{e.isSha=!1;const s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight),d.value.src=s.toDataURL("image/png");var i=document.createElement("a");i.href=d.value.src,i.download="myImage.png",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>{t.remove(),a.getTracks()[0].stop(),d.value.style.display="",s.remove()},0)}})}function y(){window.storeApi.ipcRenderer("close-capturer")}return(n,o)=>(x(),b("div",{onMousedown:v,onDblclick:o[0]||(o[0]=(...a)=>n.btntools&&n.btntools(...a)),onContextmenu:y,ref_key:"capBody",ref:h,class:f([{"ba-f8":e.isSha},"w-all rel rel hv-all"])},[m("div",{class:"boxsree abs ba-5",ref_key:"sreen",ref:l},null,512),m("img",{ref_key:"capimage",ref:d,class:"al0 rel at0",style:{display:"none"},src:"",alt:""},null,512)],34))}});export{_ as default};
